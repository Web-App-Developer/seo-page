<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <title>Mobile-First Responsive Web Design</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta name="HandheldFriendly" content="true">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@500&display=swap');
    </style>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="style.css" media="screen, handheld" />
    <link rel="stylesheet" href="css/bootstrap.min.css" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
    <script async src="//static.getclicky.com/js"></script>
    <script src="js/jquery-3.5.1.min.js"></script>
    <script defer src="js/material.min.js"></script>
    <script defer src="js/html2canvas.min.js"></script>
    <script defer src="js/serpsim.js"></script>
    <script defer src="js/jq-ajax-progress.min.js"></script>
    <script defer src="js/material-components-web.min.js"></script>
    <script defer src="js/init.js"></script>
</head>

<body>
    <header>
        <div class="topnav">
            <a href="" class="logo-img active"><img src="images/logo1.svg" alt="logo" /></a>
            </a>
            <div id="myLinks" class="m-nav">
                <a class="home active" href="#">Home</a>
                <a class="seo-blog" id="seo-blog" href="#">SEO Blog</a>
                <a class="seo-hosting" href="#">SEO Hosting</a>
            </div>
            <a href="javascript:void(0);" class="icon" onclick="myFunction()">
                <i class="fa fa-bars hanvergbtn"></i>
            </a>
        </div>
        <span id="burger" style="font-size:30px;cursor:pointer" onclick="openNav()">
                <div class="line1"></div>
                <div class="line2"></div>
                <div class="line3"></div>
              </span>
        </div>
        <div id="m-drop" class="m-drop" style="width: 100%;">
            <ul>
                <li> <a href="#seo-blog">SEO Blog</a></li>
                <li> <a href="#seo-hosting">SEO Hosting</a></li>
            </ul>
        </div>
    </header>
    <div class="main">
        <div class="advs-left">
            <img class="ads-img" src="images/case-photo.svg" alt="google-ads" />
        </div>

        <div class="center-form">
            <div class="form-wrapper">
                <div class="h-row">
                    <div class="logo-div">
                        <img class="google-logo-part inline-block-child" width="70" height="50" src="images/google_logo.svg" id="google_logo1" alt="Google Logo">
                    </div>
                    <div class="logo-text-div">
                        <p class='m-intro inline-block-child'>SERT Snippet Optimization Tool</p>
                    </div>


                </div>
                <div id="p1" class="mdl-progress mdl-js-progress"></div>
                <label for="basic-url" class="form-label h-title">Title</label>
                <label class="m-title mobile-only m-label">0px/560px</label>
                <div class="input-row-group">
                    <div class="mb-3 ht-title">
                        <input id="mofo_title" type="text" class="form-control control-width serp_input" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-sm">
                        <div class="pixel_counting_div"><span id="mofo_title_length">0px/560px</span></div>
                    </div>

                </div>
                <label for="basic-url" class="form-label h-desc">Description</label>
                <label class="m-des mobile-only">0px/990px</label>
                <div class="input-row-group">
                    <div class="mb-3 ht-desc">
                        <textarea id="mofo_desc" class="form-control control-width3 serp_input" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-sm"></textarea>
                        <div class="pixel_counting_div"><span id="mofo_desc_length">0px/990px</span></div>
                    </div>

                </div>

                <label for="basic-url" class="form-label h-url">URL</label>
                <label class="m-url mobile-only">0px/385px</label>
                <div class="input-row-group">
                    <div class="mb-3 ht-url">
                        <input id="url" type="text" class="form-control control-width serp_input" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-sm">
                        <div class="pixel_counting_div"><span id="mofo_url_length">0px/385px</span></div>
                    </div>

                </div>
                <div class="input-group mb-3">
                    <div class="input-group-prepend">
                        <div class="input-group-text1 ">
                            <input id="show_rich" type="hidden" value="0"><label for=" Rich Snippet"></label>
                            <img class="rich_snippet_btn1" src="images/radio_unselect_btn.svg" id="google_btn" alt="Google Button" onclick="myfunction1()" />
                            <span class="cb-label-txt">Rich Snippet</span>
                        </div>
                    </div>
                </div>
                <div class="input-group mb-3">
                    <div class="input-group-prepend">
                        <div class="input-group-text2">
                            <input id="show_date" value="0" type="hidden"><label for="Date"></label>
                            <img class="date_btn1" src="images/radio_unselect_btn.svg" id="google_btn" alt="Google Button" onclick="myfunction2()" />
                            <span class="cb-label-txt">Date</span>
                            <input id="show_cached" class="show_box " type="checkbox" style="display: none;" checked />
                            <input id="show_mobile" class="show_box" type="checkbox" style="display: none;" />

                        </div>
                    </div>
                </div>
            </div>


            <div class="sufer-seo-area1">
                <p class="sufer-text">ðŸš€ðŸš€ðŸš€ Want to Put Your Content to Next Level? <a href="#" class="yellow-text decor">Try Surfer SEO</a></p>
            </div>
            <div class="search-course-area1">
                <p class="course-text">ðŸ”¥ <a href="#" class="yellow-text decor">Free Online Course</a> ðŸ”¥ Keyword Research Course with Greg Gifford âžœ</p>
            </div>
            <div id="mofo_serp_preview">
                <div id="top_bar">
                    <img src="images/google_logo.svg" id="google_logo" alt="Google Logo">
                    <div id="mofo_search_div">
                        <!-- <div id="mofo_search_input" contenteditable="true"></div> -->
                        <div id="mofo_search_area">
                            <input type="text" class="mofo_input_area" id="mofo_input_area" />
                            <img src="images/search_aside.svg" id="google_close" alt="Google Close">
                        </div>
                        <div id="mofo_search_categories">
                            <div class="mofo_search_cat all-cat active"> <img src="images/search.svg" id="google_search" alt="Google Search"> <span>All</span></div>
                            <div class="mofo_search_cat"><img src="images/image.svg" id="google_image" alt="Google Image"> <span>Images</span></div>
                            <div class="mofo_search_cat"><img src="images/video.svg" id="google_image" alt="Google Image"> <span>Videos</span></div>
                            <div class="mofo_search_cat"><img src="images/News.svg" id="google_image" alt="Google Image"> <span>News</span></div>
                            <div class="mofo_search_cat"><img src="images/Maps.svg" id="google_image" alt="Google Image"> <span>Maps</span></div>
                            <div class="mofo_search_cat"><img src="images/More.svg" id="google_image" alt="Google Image"> <span>More</span></div>
                            <div class="mode_cat mobile_cat" id="mode_mobile">
                                <span class="material-icons" id="phone_iphone">
                        phone_iphone
                        </span>
                            </div>
                            <div class="mode_cat  mode_active" style="padding-left: 0px;" id="mode_desktop">
                                <span class="material-icons" id="desktop_windows">
                            desktop_windows
                        </span>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="mofo_serp_result">
                    <p id="mofo_serp_url"></p>
                    <div class="arrow_container"><span class="down_arrow"></span></div>
                    <span id="mofo_serp_title"></span><br>
                    <div id="mofo_rich_div" style="display: none;"><span id="serp_rich"><img id="score_stars" src="img/stars.png" alt="Rating stars">Rating: 9,7/10 - 112 votes</span></div>
                    <span id="serp_meta"></span>
                </div>
                <div id="mofo_serp_result_mobile" style="display: none; background-color: #fff;margin-bottom: 10px;font-size: 14px;line-height: 20px;box-shadow: 0 1px 6px rgba(32, 33, 36, 0.28);border-radius: 8px; width: 359px; margin: 0 auto; margin-top: 50px;">
                    <div id="serp_favdiv_mobile" style="font-size: 14px;line-height: 20px;color: #202124;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;padding-top: 13px;display: block; padding-left: 16px; padding-right: 16px;">
                        <img id="serp_favicon_mobile" style="margin-right: 12px;vertical-align: middle;width: 16px;height: 16px;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABs0lEQVR4AWL4//8/RRjO8Iucx+noO0MWUDo16FYABMGP6ZfUcRnWtm27jVPbtm3bttuh3t3eFPcY9pLz7NxiLjCyVd87pKnHyqXyxtCs8APd0rnyxiu4qSeA3QEDrAwBDrT1s1Rc/OrjLZwqVmOSu6+Lamcpp2KKMA9Ph3BYXMe1mUP5qotvXTywsOEEYHXxrY+3cqk6TMkYpNr2FeoY3KIr0RPtn9wQ2unlA+GMkRw6+9TFw4YTwDUzx/JVvARj9KaedXRO8P5B1Du2S32smzqUrcKGEyA+uAgQjKX7zf0boWHGfn71jIKj2689gxp7OAGShNcBUmLMPVjZuiKcA2vuWHHDCQxMCz629kXAIU4ApY15QwggAFbfOP9DhgBJ+nWVJ1AZAfICAj1pAlY6hCADZnveQf7bQIwzVONGJonhLIlS9gr5mFg44Xd+4S3XHoGNPdJl1INIwKyEgHckEhgTe1bGiFY9GSFBYUwLh3IkiJUbY407E7syBSFxKTszEoiE/YdrgCEayDmtaJwCI9uu8TKMuZSVfSa4BpGgzvomBR/INhLGzrqDotp01ZR8pn/1L0JN9d9XNyx0AAAAAElFTkSuQmCC">
                        <span id="serp_favcrumbs_mobile" style="color: #3C4043;white-space: nowrap;font-size: 12px;font-family: Roboto,HelveticaNeue,Arial,sans-serif !important;font-weight: inherit;line-height: 20px;"></span>
                    </div>
                    <div id="mofo_serp_title_mobile" style="width: 343px; word-wrap: break-word; font-size: 16px; line-height: 20px; padding-top: 12px; padding-left: 16px; padding-right: 16px; Roboto,HelveticaNeue,Arial,sans-serif !important; color: #1967D2;"></div>
                    <div id="serp_meta_mobile" style="width: 327px; word-wrap: break-word; font-size: 14px; line-height: 20px; padding-top: 12px; padding-left: 16px; padding-right: 16px; padding-bottom: 12px; Roboto,HelveticaNeue,Arial,sans-serif !important; color: #3C4043"></div>
                    <div id="mofo_rich_div_mobile" style="margin-top: -4px; width: 327px; word-wrap: break-word; font-size: 14px; line-height: 20px; padding-left: 16px; padding-right: 16px; padding-bottom: 12px;">
                        <div id="rating_mobile" style="font-size: 14px; line-height: 20px; font-family: Roboto,HelveticaNeue,Arial,sans-serif; color: #202124;">Rating</div>
                        <div id="score_mobile" style="margin-top: 5px; font-size: 14px; line-height: 20px; font-family: Roboto,HelveticaNeue,Arial,sans-serif; color: #70757A;">9,2/10 <img id="score_stars_mobile" src="img/stars_mobile.png" alt="Rating stars" style="margin-top: -3px;"> (19)</div>
                    </div>
                </div>

            </div>


            <div class="mobile-only vertical-ads">
                <img class="ads-img" src="images/case-photo.svg" alt="google-ads" />
            </div>
            <div class="mobile-only mobile-svg">
                <img class="mobile-ads-img" src="images/1.svg" alt="svg-img" />
            </div>
            <div class="snippet-area">
                <div class="snippet-left">
                    <header class="snippet-header">
                        <h2 class="h-title">About the Google SERP Snippet Optimization Tool</h2>
                    </header>
                    <div class="snippet-textarea">
                        <p class="f-content">
                            The main purpose of the SERP Snippet Optimization Tool is to allow webmasters and content publishers to strategically construct page titles and meta description tags that will result in aesthetically-pleasing or eye-catching listings in Google's organic
                            search results. Using this tool, you can optimize the content of your titles and snippets to maximize your click-through rate (CTR) from Google.
                        </p>
                        <p class="f-content1">
                            In other words, you can increase your organic search engine traffic for a specific keyword...even if you can't improve your rankings. This tactic can be especially useful in situations where you know you'll probably never outrank the sites above yours
                            (e.g. a very strong competitor, a Wikipedia page, a government website, etc.) for certain keywords. In those scenarios, your best option is to make your site's listing stand out from the rest and look as inviting as possible.
                        </p>
                    </div>
                </div>
                <div class="snippet-right">
                    <img class="snippet-area-img" src="images/1.svg">
                </div>
            </div>

            <div class="google-snippet-part">
                <h3 class="snippet-part-title">Parts of a Google Snippet</h3>
                <p class="snippet-part-text">Here is a brief explanation of the various elements that can be found in a typical Google Web Search result.
                    <h3 class="character-title">Title</h3>
                    <div class="character">
                        <div class="character-left">
                            <img class="character-part-img1" src="images/circle.svg">
                            <p class="character-part-text-left">Google shows up to 70 characters (including spaces) of a page's title in its search results.</p>
                        </div>
                        <div class="character-right">
                            <img class="character-part-img2" src="images/circle.svg">
                            <p class="character-part-text-right">If a page title exceeds 70 characters, Google will show as many whole words as it can, and the rest are replaced with an ellipsis (...).</p>
                        </div>
                    </div>



            </div>

            <div class="meta-desc-area">
                <div class="meta-left">
                    <img class="meta-area-img" src="images/2.svg">

                </div>
                <div class="meta-right">
                    <h2 class="meta-title">Snippet (Meta Description) </h2>
                    <div class="meta-snippet-textarea">
                        <p class="meta-content1">
                            Google shows up to 156 characters (including spaces) of a page's meta description tag.
                        </p>
                        <p class="meta-content2">
                            If a page's meta description tag exceeds 156 characters, Google will show as many whole words as it can, and the rest are replaced with an ellipsis (...).
                        </p>
                        <p class="meta-content3">
                            If the web page includes a published-on date, Google may include that date as part of the snippet. In these cases, the date counts as part of the 156 characters.
                        </p>
                        <p class="meta-content4">
                            To make sure your web page's snippet can fit a published-on date and the entire meta description (without getting cut off by the ellipsis), keep your meta description tag shorter than 139 characters (or 140 characters, if the published-on date is from
                            a single-digit day of the month).

                        </p>
                    </div>
                </div>
            </div>

            <div class="mobile-only mobile-svg">
                <img class="mobile-ads-img" src="images/3.svg" alt="svg-img" />
            </div>
            <div class="rich-area">
                <div class="rich-left">
                    <h2 class="r-title">Rich Snippet</h2>
                    <div class="rich-textarea">
                        <p class="r-content1">
                            Google shows rich snippet text for some types of pages and data, for example: <span class="yellow-text">reviews</span> , <span class="yellow-text">people</span>, <span class="yellow-text">businesses</span>, and
                            <span class="yellow-text">events</span>
                        </p>
                        <p class="r-content2">
                            For information about rich snippets and microformats, see Google's help page on rich snippets.

                        </p>
                    </div>
                </div>
                <div class="rich-right">
                    <img class="rich-area-img" src="images/4.svg">
                </div>
            </div>
            <div class="mobile-only mobile-svg">
                <img class="mobile-ads-img" src="images/1.svg" alt="svg-img" />
            </div>
            <div class="url-area">
                <div class="url-left">
                    <img class="url-area-img" src="images/4.svg">

                </div>
                <div class="url-right">
                    <h2 class="url-title">URL </h2>
                    <div class="url-snippet-textarea">
                        <p class="url-content1">
                            For sites with a clear information hierarchy, Google may show <span class="yellow-text">breadcrumb</span> links in the search results.
                        </p>
                        <p class="url-content2">
                            This snippet tool does not currently support any advanced URL features. These may be added in future releases.
                        </p>
                    </div>
                </div>
            </div>

            <div class="mobile-only mobile-svg">
                <img class="mobile-ads-img" src="images/5.svg" alt="svg-img" />
            </div>
            <div class="pixel-area">
                <div class="pixel-left">
                    <h2 class="p-title">Pixel based alternative</h2>
                    <div class="pixel-textarea">
                        <p class="p-content1">
                            Perhaps you prefer a <span class="yellow-text">pixel based tool?</span>
                        </p>
                        <p class="p-content2">
                            This snippet tool does not currently support any advanced URL features. These may be added in future releases.

                        </p>
                    </div>
                </div>
                <div class="pixel-right">
                    <img class="pixel-area-img" src="images/5.svg">

                </div>
            </div>
        </div>
        <div class="advs-right">
            <img class="ads-img" src="images/case-photo.svg" alt="google-ads" />
        </div>
    </div>
    <footer>
        <div class="disclaimer-area">
            <div class="disclaimer-title-area">
                <p class="disclaimer-title">Disclaimer</p>
                <p class="disclaimer-content">This snippet tool and the content of this website are not affiliated with Google nor endorsed by them. The Google logo and any other trademarks owned by Google contained herein are used for educational/non-commercial purposes only. I have
                    made every effort to replicate the appearance of Google's search results as accurately as possible, however the information on this website is provided "as is" without any representations or warranties, express or implied.</p>
            </div>

        </div>
        <hr>
        <div class="footer-area">
            <div class="footer-content-area">
                <img class="footer-logo" src="images/logo1.svg" alt="logo" />
                <p class="footer-content">Â© Copyright 2007-2020 SEOmofo.com</p>
            </div>
        </div>
    </footer>

    <script type="text/javascript" src="js/init.js"></script>
    <script type="text/javascript">
        $(document).ready(function() {

            $.ajaxSetup({
                // Disable caching of AJAX responses
                cache: false,
            });

            $.fn.textWidth = function(text, font) {
                //if (!$.fn.textWidth.fakeEl) $.fn.textWidth.fakeEl = $('<span>').hide().appendTo(document.body);
                if (!$.fn.textWidth.fakeEl) $.fn.textWidth.fakeEl = $('<span style="left: -500%; max-width: 1500px;">').hide().appendTo(document.body);
                $.fn.textWidth.fakeEl.text(text || this.val() || this.text()).css('font', font || this.css('font'));
                return $.fn.textWidth.fakeEl.width();
            };

            var max_length_title_dt = 580 //573;
            var max_length_url_dt = 385;
            var max_length_meta_dt = 990;

            var max_length_title_mb = 580;
            var max_length_url_mb = 270;
            var max_length_meta_mb = 990; //905

            var max_length_title = max_length_title_dt;
            var max_length_url = max_length_url_dt;
            var max_length_meta = max_length_meta_dt;

            var title_font_dt = '20px arial';
            var url_font_dt = '16px arial';
            var meta_font_dt = '14px arial';

            var title_font_mb = '16px Roboto';
            var url_font_mb = '14px Roboto';
            var meta_font_mb = '14px Roboto';

            var title_font = title_font_dt;
            var url_font = url_font_dt;
            var meta_font = meta_font_dt;


            $("#save_image").click(function() {
                if ($("#mofo_serp_title").text() != "" && $("#mofo_serp_url").text() != "" && $("#serp_meta").text() != "") {
                    DownloadAsImage();
                    gtag('event', 'Image', {
                        'event_category': 'Button click',
                        'event_label': $("#mofo_serp_url").text()
                    });
                } else {
                    var data = {
                        message: 'No snippet available!',
                        timeout: 3000
                    };
                    document.querySelector('#demo-toast-example').MaterialSnackbar.showSnackbar(data);

                }
            });

            function openNav() {
                mySidenav.style.width = "100%";
                burger.classList.add("change");
            }

            function closeNav() {
                mySidenav == document.getElementById("mySidenav")
                burger == document.getElementById("burger ")
                mySidenav.style.width = "0";
                burger.classList.remove("change");
            }

            function downloadURI(uri, name) {
                var link = document.createElement("a");
                link.download = name;
                link.href = uri;
                document.body.appendChild(link);
                link.click();
                link.remove();
            }

            function DownloadAsImage() {
                var element = $("#mofo_serp_result")[0];
                if ($("#show_mobile").prop('checked')) {
                    element = $("#mofo_serp_result_mobile")[0];
                }
                html2canvas(element).then(function(canvas) {
                    var myImage = canvas.toDataURL('image/png', 1.0);
                    downloadURI(myImage, "serpsim_snapshot.png");
                });
            }

            function setSERPMode(mode) {
                //console.log('SERP Mode = ' + mode);
                if (mode === 'mobile') {
                    $(".mode_active").removeClass('mode_active');
                    $("#mode_mobile").addClass('mode_active');
                    $("#show_mobile").prop('checked', true);
                    $("#mofo_serp_result").hide();
                    $("#mofo_serp_result_mobile").show();
                    title_font = title_font_mb;
                    url_font = url_font_mb;
                    meta_font = meta_font_mb;
                    max_length_title = max_length_title_mb;
                    max_length_url = max_length_url_mb;
                    max_length_meta = max_length_meta_mb;
                    $("#mofo_title").trigger('keyup');
                    $("#url").trigger('keyup');
                    $("#mofo_desc").trigger('keyup');
                } else if (mode === 'desktop') {
                    $(".mode_active").removeClass('mode_active');
                    $("#mode_desktop").addClass('mode_active');
                    $("#show_mobile").prop('checked', false);
                    $("#mofo_serp_result_mobile").hide();
                    $("#mofo_serp_result").show();
                    title_font = title_font_dt;
                    url_font = url_font_dt;
                    meta_font = meta_font_dt;
                    max_length_title = max_length_title_dt;
                    max_length_url = max_length_url_dt;
                    max_length_meta = max_length_meta_dt;
                    $("#mofo_title").trigger('keyup');
                    $("#url").trigger('keyup');
                    $("#mofo_desc").trigger('keyup');
                }
            }

            function isURL(str) {
                regexp = /^(?:(?:https?|ftp):\/\/)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:\/\S*)?$/;
                if (regexp.test(str)) {
                    return true;
                } else {
                    return false;
                }
            }

            function mobileURL(url) {
                if (url.length > 7 && url.includes('/')) {
                    if (url.endsWith('/')) {
                        url = url.slice(0, -1);
                    }
                    exp = url.split(/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/);
                    prefix_string = exp[2] + ':' + exp[3];
                    path = exp[5].replace(/\//g, ' â€º ');
                    if (path === ' > ') {
                        path = '';
                    }
                    if (url.indexOf('https://') == 0) {
                        return (prefix_string + path);
                    } else {
                        return (exp[4] + path);
                    }
                }
            }

            function stripTrailingSlash(str) {
                if (str.substr(-1) === '/') {
                    return str.substr(0, str.length - 1);
                }
                return str;
            }

            function extractDomain(url) {
                var domain;
                if (url.indexOf("://") > -1) {
                    domain = url.split('/')[2];
                } else {
                    domain = url.split('/')[0];
                }

                if (domain.indexOf("www.") > -1) {
                    domain = domain.split('www.')[1];
                }

                domain = domain.split(':')[0]; //find & remove port number
                domain = domain.split('?')[0]; //find & remove url params

                return domain;
            }

            function arrowNavigation(element, event) {
                switch (event.which) {
                    case 38: //UP
                        element.parent().parent().prev().find('.serp_input:first').focus();
                        break;
                    case 40: //DOWN
                        element.parent().parent().next().find('.serp_input:first').focus();
                        break;
                }
            }

            function substringPixels(phrase, limit, font) {
                pixel_width = 0;
                for (var i = 0, c = ''; c = phrase.charAt(i); i++) {
                    if (pixel_width + $.fn.textWidth(c, font) > limit) {
                        return phrase.substring(0, i);
                        break;
                    } else {
                        pixel_width = pixel_width + $.fn.textWidth(c, font);
                    }
                }
                return phrase;
            }

            function truncateUrlMobile(url) {
                suffix_length = $.fn.textWidth('...', url_font);
                allowed_length = max_length_url - suffix_length;
                surl = url;
                for (var i = 0; surl = surl.substring(0, surl.length - 1); i++) {
                    //console.log(surl + "(" + $.fn.textWidth(surl, url_font) + ")");
                    if ($.fn.textWidth(surl, url_font) <= allowed_length) {
                        return surl + '...';
                        break;
                    } else {}
                }
            }

            function truncateUrl(url) {
                exp = url.split(/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/);
                prefix_string = exp[2] + ':' + exp[3];
                prefix = $.fn.textWidth(prefix_string, url_font);
                path = exp[5].split("/");
                last_part = '/' + path[path.length - 1];
                if (last_part == '/') {
                    last_part = '/' + path[path.length - 2] + '/';
                }
                last_part_pixels = $.fn.textWidth(last_part, url_font);
                fit_last = true;
                offset = 0;
                if ($("#show_cached").prop('checked')) {
                    offset = 54;
                }
                remains = max_length_url - prefix - last_part_pixels - offset - 32;
                suffix = "";
                if (remains < 0) {
                    suffix = '/...' + substringPixels(last_part, last_part_pixels + remains, url_font) + ' ...';
                } else if (remains < 15.52) {
                    pre_suffix = "";
                    if (substringPixels(exp[5], remains) != "") {
                        pre_suffix = substringPixels(exp[5], remains, url_font);
                    } else {
                        pre_suffix = "/";
                    }
                    suffix = pre_suffix + '...' + substringPixels(last_part, last_part_pixels + remains, url_font) + ' ...';
                } else {
                    suffix = substringPixels(exp[5], remains, url_font) + '...' + last_part;
                }
                return prefix_string + suffix;
            }

            function truncateString(text, length) {
                if (text.length >= length) {
                    return text.substring(0, length - 3) + '...';
                } else {
                    return text;
                }
            }

            function uncheckBoxes() {
                $(".show_box").each(function() {
                    if ($(this).prop('checked') === true && $(this).attr('id') !== 'show_mobile') {
                        $(this).trigger('click');
                    }
                });
            }

            function clearInput() {
                $("#ext_url").val('').trigger('keyup');
                $("#mofo_title").val('').trigger('keyup');
                $("#url").val('').trigger('keyup');
                $("#mofo_desc").val('').trigger('keyup');
                $("#snippet_id").val('');
                $(".active_snippet").removeClass('active_snippet');
                $("#serp_favicon_mobile").attr('src', 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABs0lEQVR4AWL4//8/RRjO8Iucx+noO0MWUDo16FYABMGP6ZfUcRnWtm27jVPbtm3bttuh3t3eFPcY9pLz7NxiLjCyVd87pKnHyqXyxtCs8APd0rnyxiu4qSeA3QEDrAwBDrT1s1Rc/OrjLZwqVmOSu6+Lamcpp2KKMA9Ph3BYXMe1mUP5qotvXTywsOEEYHXxrY+3cqk6TMkYpNr2FeoY3KIr0RPtn9wQ2unlA+GMkRw6+9TFw4YTwDUzx/JVvARj9KaedXRO8P5B1Du2S32smzqUrcKGEyA+uAgQjKX7zf0boWHGfn71jIKj2689gxp7OAGShNcBUmLMPVjZuiKcA2vuWHHDCQxMCz629kXAIU4ApY15QwggAFbfOP9DhgBJ+nWVJ1AZAfICAj1pAlY6hCADZnveQf7bQIwzVONGJonhLIlS9gr5mFg44Xd+4S3XHoGNPdJl1INIwKyEgHckEhgTe1bGiFY9GSFBYUwLh3IkiJUbY407E7syBSFxKTszEoiE/YdrgCEayDmtaJwCI9uu8TKMuZSVfSa4BpGgzvomBR/INhLGzrqDotp01ZR8pn/1L0JN9d9XNyx0AAAAAElFTkSuQmCC');
                uncheckBoxes();
            }

            function fillClipboard() {
                var clipboard_data = "";
                $(".snippet_list").filter(":visible").each(function(i) {
                    clipboard_data += $(this).attr("data-serp-title") + "\t" + $(this).attr("data-serp-url") + "\t" + $(this).attr("data-serp-meta") + "\r\n";
                });
                $("#clipboard_data").val(clipboard_data);
            }

            function loadSnippet(snippet) {
                if (snippet.hasClass('error')) {
                    snippet.removeClass('error');
                    snippet.addClass('had_error');
                }
                snippet.addClass('active_snippet');
                snippet.find('.saved_title:first').addClass('active_snippet');
                snippet.find('.saved_url:first').addClass('active_snippet');
                snippet.find('.delete_snippet:first').addClass('active_snippet');
                snippet.find('.snippet_number:first').addClass('active_snippet');
                $("#mofo_title").val(snippet.attr('data-serp-title')).trigger('keyup');
                $("#url").val(snippet.attr('data-serp-url')).trigger('keyup');
                $("#mofo_desc").val(snippet.attr('data-serp-meta')).trigger('keyup');
                $("#snippet_id").val(snippet.attr('data-snippet-id'));
                document.querySelector('#logo_div').scrollIntoView({
                    behavior: 'smooth'
                });
            }

            function calcNumbers() {
                var snippCount = $(".snippet_list").length;
                $(".snippet_list").each(function(i) {
                    currNo = parseInt(snippCount) - parseInt(i);
                    $(this).attr('data-list-number', currNo);
                    if (currNo % 2 === 0) {
                        $(this).addClass('evenDiv');
                    } else {
                        $(this).removeClass('evenDiv');
                    }
                    $(".snippet_number", this).html(currNo + '.');
                });
            }

            $("#filter_snippet").click(function() {
                if ($(this).prop("checked")) {
                    $(".snippet_list").hide();
                    $(".snippet_list.error").show();
                    $(".snippet_list.had_error").show();
                } else {
                    $(".snippet_list").show();
                }
            });

            //SHARE BUTTON
            $("#share").click(function() {
                if ($(".snippet_list").length == 0 && ($("#mofo_serp_title").text() == '' && $("#mofo_serp_url").text() == '' && $("#serp_meta").text() == '')) {
                    var data = {
                        message: 'Nothing to share',
                        timeout: 2000
                    };
                    document.querySelector('#demo-toast-example').MaterialSnackbar.showSnackbar(data);
                } else {
                    if ($(".snippet_list").length == 0 && ($("#mofo_serp_title").text() != '' && $("#mofo_serp_url").text() != '' && $("#serp_meta").text() != '')) {
                        $("#save_snippet").trigger('click');
                    }
                    serpsim_url = window.location.href;
                    $("#clipboard_data").val(serpsim_url);

                    var data = {
                        message: 'Project-URL copied to clipboard',
                        timeout: 4000
                    };

                    var tempInput = document.createElement("textarea");
                    tempInput.style = "position: absolute; left: -1000px; top: -1000px";
                    tempInput.value = $("#clipboard_data").val();
                    document.body.appendChild(tempInput);
                    tempInput.select();
                    document.execCommand("copy");
                    document.body.removeChild(tempInput);
                    document.querySelector('#demo-toast-example').MaterialSnackbar.showSnackbar(data);
                    gtag('event', 'Share', {
                        'event_category': 'Snippet',
                        'event_label': serpsim_url
                    });
                }
            });

            //COPY BUTTON SMALL
            $("#copy").click(function() {
                if ($(".snippet_list").filter(":visible").length > 0) {
                    $(".copy").trigger("click");
                } else {
                    clipboard_data = $("#mofo_title").val() + "\t" + $("#url").val() + "\t" + $("#mofo_desc").val() + "\r\n";
                    $("#clipboard_data").val(clipboard_data);

                    var data = {
                        message: 'Snippet copied to clipboard.',
                        timeout: 2000
                    };

                    var tempInput = document.createElement("textarea");
                    tempInput.style = "position: absolute; left: -1000px; top: -1000px";
                    tempInput.value = $("#clipboard_data").val();
                    document.body.appendChild(tempInput);
                    tempInput.select();
                    document.execCommand("copy");
                    document.body.removeChild(tempInput);
                    document.querySelector('#demo-toast-example').MaterialSnackbar.showSnackbar(data);
                }
            });

            //CLEAR BUTTON
            $("#clear").click(function() {
                clearInput();
            });

            //COPY BUTTON
            $(document).on("click", ".copy", function() {
                fillClipboard();
                var data = {
                    message: $(".snippet_list").filter(":visible").length + ' snippets copied to clipboard.',
                    timeout: 2000
                };
                var tempInput = document.createElement("textarea");
                tempInput.style = "position: absolute; left: -1000px; top: -1000px";
                tempInput.value = $("#clipboard_data").val();
                document.body.appendChild(tempInput);
                tempInput.select();
                document.execCommand("copy");
                document.body.removeChild(tempInput);
                document.querySelector('#demo-toast-example').MaterialSnackbar.showSnackbar(data);
            });

            //ENTER KEY in EXT URL
            $("#ext_url").keyup(function(e) {
                arrowNavigation($(this), e);
                if (e.keyCode == 13) {
                    $("#fetch_url").trigger('click');
                }
            });


            //SAVE SNIPPET
            $("#save_snippet").click(function() {
                if ($("#mofo_serp_title").text() != '' && $("#mofo_serp_url").text() != '' && $("#serp_meta").text() != '') {
                    $("#mofo_serp_result").addClass('fadeOutDown');
                    setTimeout(function() {
                        $("#mofo_serp_result").removeClass('fadeOutDown');
                        if ($("#snippet_id").val() == '' || $(".snippet_list[data-snippet-id='" + $("#snippet_id").val() + "']").length === 0) {
                            $('<div class="snippet_list" data-snippet-id="' + Date.now() + Math.random() + '" data-serp-title="' + $("#mofo_title").val() + '" data-serp-url="' + $("#url").val() + '" data-serp-meta="' + $("#mofo_desc").val() + '" data-list-number="' + (parseInt($(".snippet_list").length) + 1) + '"><div class="snippet_number">' + ($(".snippet_list").length + 1) + '.</div><div class="snippet_text"><span class="saved_title">' + truncateString($("#mofo_serp_title").text(), 65) + '</span><span class="saved_url">' + truncateString($("#mofo_serp_url").text(), 80) + '</span></div><div class="snippet_options"><i class="material-icons delete_snippet">clear</i></div>').insertAfter($("#snippet_list_header"));
                            if ($(".snippet_list").length % 2 === 0) {
                                $(".snippet_list:first").addClass('evenDiv');
                            }
                        } else {
                            if ($.fn.textWidth($("#mofo_title").val(), title_font) <= max_length_title && $.fn.textWidth($("#mofo_desc").val(), meta_font) <= max_length_meta) {
                                $(".snippet_list[data-snippet-id='" + $("#snippet_id").val() + "']").removeClass('error').removeClass('had_error');
                            } else {
                                $(".snippet_list[data-snippet-id='" + $("#snippet_id").val() + "']").addClass('error');
                            }

                            $(".snippet_list[data-snippet-id='" + $("#snippet_id").val() + "']").attr("data-serp-title", $("#mofo_title").val()).attr("data-serp-url", $("#url").val()).attr("data-serp-meta", $("#mofo_desc").val());
                            $(".snippet_list[data-snippet-id='" + $("#snippet_id").val() + "']").find(".saved_title:first").html(truncateString($("#mofo_serp_title").text(), 65));
                            $(".snippet_list[data-snippet-id='" + $("#snippet_id").val() + "']").find(".saved_url:first").html(truncateString($("#mofo_serp_url").text(), 80));
                        }

                        extra_snippets = [];
                        $(".snippet_list").each(function(i) {
                            extra_snippets[i] = [$(this).attr("data-list-number"), $(this).attr("data-snippet-id"), $(this).attr("data-serp-title"), $(this).attr("data-serp-url"), $(this).attr("data-serp-meta")];
                        });

                        slug = window.location.pathname.replace(/\//g, '');
                        if (slug) {
                            $.post("/process_serpsim", {
                                action: 'update',
                                title: $("#mofo_title").val(),
                                url: $("#url").val(),
                                meta: $("#mofo_desc").val(),
                                extra: extra_snippets,
                                slug: slug
                            });
                            gtag('event', 'Update', {
                                'event_category': 'Button click',
                                'event_label': slug
                            });
                        } else {
                            $.post("/process_serpsim", {
                                action: 'save',
                                title: $("#mofo_title").val(),
                                url: $("#url").val(),
                                meta: $("#mofo_desc").val(),
                                extra: extra_snippets
                            }).done(function(json) {
                                history.replaceState({}, 'Serpsim', "/" + $.parseJSON(json).slug + "/");
                                slug = $.parseJSON(json).slug;
                                gtag('event', 'Save', {
                                    'event_category': 'Button click',
                                    'event_label': slug
                                });
                            });
                        }

                        $("#list_container").show();
                        var data = {
                            message: 'Snippet saved.',
                            timeout: 2000
                        };
                        document.querySelector('#demo-toast-example').MaterialSnackbar.showSnackbar(data);
                        clearInput();
                    }, 1000);
                } else {
                    var data = {
                        message: 'Missing data, unable to save.',
                        timeout: 2000
                    };
                    document.querySelector('#demo-toast-example').MaterialSnackbar.showSnackbar(data);
                }

            });


            //SHOW DATE
            $("#show_date").click(function() {
                var date_string = '24 Dec, 2019 - ';
                var elm_id = 'serp_meta';
                if ($("#show_mobile").prop('checked')) {
                    date_string = '24 Dec 2019 Â· ';
                    elm_id = 'serp_meta_mobile';
                }
                if ($("#show_date").prop('checked')) {
                    $("#mofo_desc").trigger('keyup');
                    $("#" + elm_id).prepend('<span id="rich_date">' + date_string + '</span>');
                } else {
                    $("#" + elm_id).html($("#serp_meta").html().replace(date_string, ''));
                    $("#mofo_desc").trigger('keyup');
                }
            });

            //SHOW CACHED
            $("#show_cached").click(function() {
                if ($(".arrow_container").css('display') == 'none') {
                    $(".arrow_container").css('display', 'inline');
                    $("#mofo_serp_url_mobile").prepend('<img src="/img/amp_logo.png" alt="AMP logo" style="margin-right: 6px; margin-top: -1px;"/>');
                } else {
                    $("#mofo_serp_url_mobile").text($("#mofo_serp_url_mobile").text().replace('<img src="/img/amp_logo.png" alt="AMP logo" style="margin-right: 6px; margin-top: -1px;"/>', ''));
                    //console.log($("#mofo_serp_url_mobile").text());
                    $(".arrow_container").css('display', 'none');
                    $("#url").trigger('keyup');
                }
            });

            //MODE MOBILE
            $("#mode_mobile").click(function() {
                setSERPMode('mobile');
            });

            //MODE DESKTOP
            $("#mode_desktop").click(function() {
                setSERPMode('desktop');
            });

            //DELETE SNIPPET
            $(document).on("click", ".delete_snippet", function() {
                $(this).closest('.snippet_list').remove();
                calcNumbers();
                if ($(".snippet_list").length == 0) {
                    $("#list_container").hide();
                }
                var data = {
                    message: 'Snippet removed.',
                    timeout: 2000
                };
                slug = window.location.pathname.replace(/\//g, '');
                extra_snippets = [];
                $(".snippet_list").each(function(i) {
                    extra_snippets[i] = [$(this).attr("data-list-number"), $(this).attr("data-snippet-id"), $(this).attr("data-serp-title"), $(this).attr("data-serp-url"), $(this).attr("data-serp-meta")];
                });
                $.post("/process_serpsim", {
                    action: 'update',
                    title: $("#mofo_title").val(),
                    url: $("#url").val(),
                    meta: $("#mofo_desc").val(),
                    extra: extra_snippets,
                    slug: slug
                }).done(function() {
                    document.querySelector('#demo-toast-example').MaterialSnackbar.showSnackbar(data);
                });
                if ($(".snippet_list").length == 0) {
                    $("#list_container").hide();

                }
            });

            //LOAD SNIPPET
            $(document).on("click", ".snippet_text", function() {
                $(".had_error").each(function() {
                    $(this).addClass('error').removeClass('had_error');
                });
                clearInput();
                loadSnippet($(this).closest('.snippet_list'));
            });

            //Bind eventhandler to progressbar
            document.getElementById('p1').addEventListener('mdl-componentupgraded', function() {
                document.getElementById('p1').MaterialProgress.setProgress(0);
            });

            //EXT URL
            $("#ext_url").bind('paste', function() {
                setTimeout(function() {
                    var paste_list = $("#ext_url").val();
                    arrURLs = paste_list.split(" ");
                    if (arrURLs.length < 2) {
                        return;
                    }
                    containsErr = false;
                    invalidData = "";
                    for (let i = 0, size = arrURLs.length; i < size; i++) {
                        if (!isURL(arrURLs[i])) {
                            invalidData = arrURLs[i];
                            containsErr = true;
                            break;
                        }
                    }
                    if (containsErr) { //INVALID DATA
                        var data = {
                            message: 'Data pasted contained invalid url data ("' + invalidData + '").',
                            timeout: 2000
                        };
                        document.querySelector('#demo-toast-example').MaterialSnackbar.showSnackbar(data);
                        $("#ext_url").val('');
                    } else { //URL LIST OK
                        var error_alert = 0;
                        $("#p1").show();
                        var lastResponseLength = false;
                        var ajaxRequest = $.ajax({
                            type: 'get',
                            url: '/process_serpsim',
                            data: {
                                action: 'bulk',
                                urls: $("#ext_url").val().trim()
                            },
                            processData: true,
                            xhrFields: {
                                // Getting on progress streaming response
                                onprogress: function(e) {
                                    var progressResponse;
                                    var response = e.currentTarget.response;
                                    if (lastResponseLength === false) {
                                        progressResponse = response;
                                        lastResponseLength = response.length;
                                    } else {
                                        progressResponse = response.substring(lastResponseLength);
                                        lastResponseLength = response.length;
                                    }
                                    if (progressResponse.indexOf('[') == -1) {
                                        try {
                                            var parsedResponse = JSON.parse(progressResponse);
                                            if (parsedResponse.progress !== "undefined") {
                                                document.getElementById('p1').MaterialProgress.setProgress(parsedResponse.progress);
                                            }
                                        } catch (e) {
                                            return false;
                                        }
                                    }
                                }
                            }
                        });

                        // On failed
                        ajaxRequest.fail(function(error) {
                            if (error == 'sitemap_index') {
                                error_alert = 1;
                                return;
                            }
                        });

                        // On completed
                        ajaxRequest.done(function(json) {
                            $("#p1").hide();
                            document.getElementById('p1').MaterialProgress.setProgress(0);
                            if ($("#show_mobile").prop('checked')) {
                                setSERPMode('mobile');
                            } else {
                                setSERPMode('desktop');
                            }
                            uncheckBoxes();

                            parsed_json = JSON.parse(json.slice(json.indexOf('['), json.length));

                            $.each(parsed_json, function(i, item) {
                                var snippet_class = "snippet_list";
                                if ($.fn.textWidth(item.title, title_font) > max_length_title || $.fn.textWidth(item.meta, meta_font) > max_length_meta) {
                                    snippet_class += " error";
                                }
                                $('<div class="' + snippet_class + '" data-snippet-id="' + Date.now() + Math.random() + '" data-serp-title="' + item.title + '" data-serp-url="' + item.url + '" data-serp-meta="' + item.meta + '" data-list-number="' + (parseInt($(".snippet_list").length) + 1) + '"><div class="snippet_number">' + (parseInt($(".snippet_list").length) + 1) + '.</div><div class="snippet_text"><span class="saved_title">' + truncateString(item.title, 65) + '</span><span class="saved_url">' + truncateString(item.url, 80) + '</span></div><div class="snippet_options"><i class="material-icons delete_snippet">clear</i></div>').insertAfter($("#snippet_list_header"));
                                if ($(".snippet_list").length % 2 === 0) {
                                    $(".snippet_list:first").addClass('evenDiv');
                                }
                            });
                            if ($(".snippet_list").length > 0) {
                                $("#list_container").show();
                            }
                            var data = {
                                message: 'Saved snippets loaded',
                                timeout: 2000
                            };
                            if (data) {
                                document.querySelector('#demo-toast-example').MaterialSnackbar.showSnackbar(data);
                            }
                            loadSnippet($(".snippet_list:first"));

                            var alert_msg = 'Data from URL downloaded.';
                            if (error_alert == 1) {
                                alert_msg = 'Sitemap index-file detected. Please enter the actual sitemap.xml URL.';
                            }
                            var data = {
                                message: alert_msg,
                                timeout: 3000
                            };
                            document.querySelector('#demo-toast-example').MaterialSnackbar.showSnackbar(data);
                        });

                    }
                }, 100);
            });

            $("#fetch_url").click(function() {
                $("#ext_url").val($("#ext_url").val().replace('\t', '').trim());
                if (!isURL($("#ext_url").val())) {
                    var data = {
                        message: 'Invalid URL',
                        timeout: 2000
                    };
                    document.querySelector('#demo-toast-example').MaterialSnackbar.showSnackbar(data);
                    return;
                }
                //SITEMAP
                if ($("#ext_url").val().includes("sitemap") && $("#ext_url").val().endsWith(".xml")) {
                    $(".snippet_list").remove();
                    $("#list_container").hide();
                    $("#mofo_title").val('').trigger('keyup');
                    $("#url").val('').trigger('keyup');
                    $("#mofo_desc").val('').trigger('keyup');
                    $("#snippet_id").val('');
                    $(".active_snippet").removeClass('active_snippet');
                    uncheckBoxes();

                    //$("#ext_url_status").show();
                    var error_alert = 0;
                    $("#p1").show();
                    var lastResponseLength = false;
                    var ajaxRequest = $.ajax({
                        type: 'get',
                        url: '/process_serpsim',
                        data: {
                            action: 'sitemap',
                            url: $("#ext_url").val().trim()
                        },
                        processData: true,
                        xhrFields: {
                            // Getting on progress streaming response
                            onprogress: function(e) {
                                var progressResponse;
                                var response = e.currentTarget.response;
                                if (lastResponseLength === false) {
                                    progressResponse = response;
                                    lastResponseLength = response.length;
                                } else {
                                    progressResponse = response.substring(lastResponseLength);
                                    lastResponseLength = response.length;
                                }
                                try {
                                    var parsedResponse = JSON.parse(progressResponse);
                                    if (parsedResponse.progress !== "undefined") {
                                        document.getElementById('p1').MaterialProgress.setProgress(parsedResponse.progress);
                                    }
                                } catch (e) {
                                    return false;
                                }
                                var parsedResponse = JSON.parse(progressResponse);
                                if (parsedResponse.progress !== "undefined") {
                                    document.getElementById('p1').MaterialProgress.setProgress(parsedResponse.progress);
                                }
                            }
                        }
                    });

                    // On failed
                    ajaxRequest.fail(function(error) {
                        if (error == 'sitemap_index') {
                            error_alert = 1;
                            return;
                        }
                    });

                    // On completed
                    ajaxRequest.done(function(json) {
                        $("#p1").hide();
                        document.getElementById('p1').MaterialProgress.setProgress(0);
                        if ($("#show_mobile").prop('checked')) {
                            setSERPMode('mobile');
                        } else {
                            setSERPMode('desktop');
                        }
                        uncheckBoxes();

                        parsed_json = JSON.parse(json.slice(json.indexOf('['), json.length));

                        $.each(parsed_json, function(i, item) {
                            var snippet_class = "snippet_list";
                            if ($.fn.textWidth(item.title, title_font) > max_length_title || $.fn.textWidth(item.meta, meta_font) > max_length_meta) {
                                snippet_class += " error";
                            }
                            $('<div class="' + snippet_class + '" data-snippet-id="' + Date.now() + Math.random() + '" data-serp-title="' + item.title + '" data-serp-url="' + item.url + '" data-serp-meta="' + item.meta + '" data-list-number="' + (parseInt($(".snippet_list").length) + 1) + '"><div class="snippet_number">' + (parseInt($(".snippet_list").length) + 1) + '.</div><div class="snippet_text"><span class="saved_title">' + truncateString(item.title, 65) + '</span><span class="saved_url">' + truncateString(item.url, 80) + '</span></div><div class="snippet_options"><i class="material-icons delete_snippet">clear</i></div>').insertAfter($("#snippet_list_header"));
                            if ($(".snippet_list").length % 2 === 0) {
                                $(".snippet_list:first").addClass('evenDiv');
                            }
                        });
                        if ($(".snippet_list").length > 0) {
                            $("#list_container").show();
                        }
                        var data = {
                            message: 'Saved snippets loaded',
                            timeout: 2000
                        };
                        if (data) {
                            document.querySelector('#demo-toast-example').MaterialSnackbar.showSnackbar(data);
                        }
                        loadSnippet($(".snippet_list:first"));

                        var alert_msg = 'Data from URL downloaded.';
                        if (error_alert == 1) {
                            alert_msg = 'Sitemap index-file detected. Please enter the actual sitemap.xml URL.';
                        }
                        var data = {
                            message: alert_msg,
                            timeout: 3000
                        };
                        document.querySelector('#demo-toast-example').MaterialSnackbar.showSnackbar(data);
                        $("#ext_url_status").hide();
                    });
                } else {
                    $("#ext_url_status").show();
                    $.getJSON("/process_serpsim", {
                        action: 'fetch_url',
                        url: $("#ext_url").val().trim()
                    }, function(json) {
                        if ($("#show_mobile").prop('checked')) {
                            setSERPMode('mobile');
                        } else {
                            setSERPMode('desktop');
                        }
                        uncheckBoxes();
                        if (json.error == 'missing_title') {
                            error_alert = 1;
                            return;
                        }

                        $("#serp_favicon_mobile").attr('src', 'https://www.google.com/s2/favicons?domain=' + extractDomain(json.url.replace(/\s+/g, " ")));
                        //$("#serp_favcrumbs_mobile").text(json.url.replace(/\s+/g, " ").replace(/([^\/])(\/)([^\/])/g,"$1 > $3").replace(/\.[^/.]+$/, ""));
                        $("#serp_favcrumbs_mobile").text(json.url.replace(/\s+/g, " ").replace(/([^\/])(\/)([^\/])/g, "$1 â€º $3").replace(/\/$/, ""));
                        $("#mofo_title").val(json.title.replace(/\s+/g, " ")).trigger('keyup');
                        $("#mofo_desc").val(json.meta.replace(/\s+/g, " ")).trigger('keyup');
                        $("#url").val(json.url.replace(/\s+/g, " ")).trigger('keyup');
                        //$("#url").val(json.url.replace(/\s+/g, " ").replace(/([^\/])(\/)([^\/])/g,"$1 â€º $3").replace(/\/$/, "")).trigger('keyup');
                        $("#ext_url").val(json.url);
                        $("#snippet_id").val('');
                        $(".active_snippet").removeClass('active_snippet');
                    }).done(function() {
                        var alert_msg = 'Data from URL downloaded.';
                        if (error_alert == 1) {
                            alert_msg = "Unable to fetch data from URL. Possibly caused by misconfigured gzip or encoding issue.";
                        }

                        var data = {
                            message: alert_msg,
                            timeout: 3000
                        };
                        document.querySelector('#demo-toast-example').MaterialSnackbar.showSnackbar(data);
                        gtag('event', 'Fetch url', {
                            'event_category': 'Button click',
                            'event_label': $("#ext_url").val()
                        });
                        $("#ext_url_status").hide();
                    });
                }
            });

            //TITLE
            $("#mofo_serp_title").click(function() {
                url = $("#mofo_serp_url").text();
                if (!/^https?:\/\//i.test(url)) {
                    url = 'http://' + url;
                }
                window.open(url);
            });

            $("#mofo_title").keyup(function(e) {
                arrowNavigation($(this), e);
                title_pixel_length = $.fn.textWidth($("#mofo_title").val(), title_font);
                curr_length = "";
                if (title_pixel_length > max_length_title) {
                    title_chunks = $("#mofo_title").val().split(" ");
                    real_result = "";
                    real_length = 0;
                    prev_result = "";
                    for (var i = 0, len = title_chunks.length; i < len; i++) {
                        new_title_length = Math.ceil(parseFloat(real_length) + parseFloat($.fn.textWidth(title_chunks[i], title_font)));
                        if (new_title_length < max_length_title) {
                            prev_result = real_result;
                            real_result += ' ' + title_chunks[i];
                            console.log('prev_result : ' + prev_result + '(' + new_title_length + ')');
                            console.log('real_result : ' + real_result + '(' + $.fn.textWidth(real_result, title_font) + ')');
                        } else if (title_chunks.length === 1) {
                            real_result = substringPixels(title_chunks[0], max_length_title, title_font) + ' ...'
                        } else {
                            console.log('Okay here we go...');
                            console.log('prev_result: ' + prev_result);
                            if ($.fn.textWidth(real_result, title_font) > max_length_title) {
                                real_result = prev_result;
                            }
                            var b = 0;
                            while (!real_result.slice(-1).match(/[a-zÃ¥Ã¤Ã¶A-ZÃ…Ã„Ã–0-9]/i)) {
                                if (b > 10) {
                                    break;
                                }
                                real_result = real_result.slice(0, -1);
                                b++;
                            }

                            real_result += ' ...';
                            break;
                        }
                        real_length = $.fn.textWidth(real_result, title_font);
                    }
                    if ($("#show_mobile").prop('checked')) {
                        $("#mofo_serp_title_mobile").text(real_result);
                    } else {
                        $("#mofo_serp_title").text(real_result);
                    }
                    curr_length = "<strong><span class='alert'>" + Math.ceil(title_pixel_length) + "px</span></strong>";
                } else if ($("#show_mobile").prop('checked')) {
                    $("#mofo_serp_title_mobile").text($("#mofo_title").val());
                    curr_length = Math.ceil(title_pixel_length) + "px";
                } else {
                    $("#mofo_serp_title").text($("#mofo_title").val());
                    curr_length = Math.ceil(title_pixel_length) + "px";
                }
                // $("#mofo_title_length").html('(' + curr_length + ' / ' + max_length_title + 'px)');
                // $("#mofo_title_length_mobile").html('(' + curr_length + ' / ' + max_length_title + 'px)');
                $("#mofo_title_length").html(curr_length + '/' + max_length_title + 'px');
                $("#mofo_title_length_mobile").html(curr_length + '/' + max_length_title + 'px)');
            });

            //META DESCRIPTION
            $("#mofo_desc").keyup(function(e) {
                arrowNavigation($(this), e);
                meta_text = $("#mofo_desc").val();
                if ($("#show_date").prop('checked')) {
                    meta_text = '24 Dec, 2018 - ' + meta_text;
                }
                prepend_string = '';
                meta_pixel_length = $.fn.textWidth(meta_text, meta_font);
                if (meta_pixel_length > max_length_meta) {
                    meta_chunks = meta_text.split(" ");
                    real_result = "";
                    real_length = 0;
                    for (var i = 0, len = meta_chunks.length; i < len; i++) {
                        new_meta_string = real_result + ' ' + meta_chunks[i];
                        new_meta_length = Math.ceil($.fn.textWidth(new_meta_string, meta_font));
                        if (new_meta_length < max_length_meta) {
                            real_result += ' ' + meta_chunks[i];
                        } else if (meta_chunks.length === 1) {
                            real_result = $.fn.textWidth(meta_chunks[i], meta_font) + ' ...'
                        } else {
                            var b = 0;
                            split_chunk = meta_chunks[i].replace(/,/g, ' ').split(' ')[0];
                            if ((real_length + $.fn.textWidth(split_chunk, meta_font) + $.fn.textWidth('. ..', meta_font)) < max_length_meta) {
                                real_result += ' ' + split_chunk;
                            }
                            real_result += ' ...';
                            break;
                        }
                        real_length = $.fn.textWidth(real_result, meta_font);
                    }
                    if ($("#show_mobile").prop('checked')) {
                        $("#serp_meta_mobile").text(real_result.replace('24 Dec, 2018 - ', ''));
                    } else {
                        $("#serp_meta").text(real_result.replace('24 Dec, 2018 - ', ''));
                    }
                    curr_length = "<strong><span class='alert'>" + Math.ceil(meta_pixel_length) + "px</span></strong>";
                } else if ($("#show_mobile").prop('checked')) {
                    $("#serp_meta_mobile").text($("#mofo_desc").val());
                    curr_length = Math.ceil(meta_pixel_length) + 'px';
                } else {
                    $("#serp_meta").text($("#mofo_desc").val());
                    curr_length = Math.ceil(meta_pixel_length) + 'px';
                }
                $("#mofo_desc_length").html(curr_length + '/' + max_length_meta + 'px');
                $("#mofo_desc_length_mobile").html(curr_length + '/' + max_length_meta + 'px');
            });


            //URL
            $("#url").keyup(function(e) {
                console.log('triggered!');
                arrowNavigation($(this), e);
                var url_val = $("#url").val().replace(/\s+/g, " ").replace(/([^\/])(\/)([^\/])/g, "$1 â€º $3").replace('.html', '').replace(/\/$/, "");
                url_val = mobileURL(url_val);
                if ($("#show_mobile").prop('checked')) {
                    $("#serp_favcrumbs_mobile").text($("#url").val().replace(/\s+/g, " ").replace(/([^\/])(\/)([^\/])/g, "$1 â€º $3").replace(/\/$/, ""));
                } else {
                    $("#mofo_serp_url").text($("#url").val().replace(/^https?:\/\//, '').replace(/\s+/g, " ").replace(/([^\/])(\/)([^\/])/g, "$1 â€º $3").replace(/\/$/, ""));
                    if (url_val !== undefined) {
                        url_val = url_val.replace(/^https?:\/\//, '');
                    }
                }
                url_pixel_length = $.fn.textWidth(url_val, url_font);
                curr_length = "";
                offset = 0;
                if ($("#show_cached").prop('checked')) {
                    offset = 54;
                }
                if (url_pixel_length > (max_length_url - offset)) {
                    if ($("#show_mobile").prop('checked')) {
                        $("#mofo_serp_url_mobile").html(truncateUrlMobile(url_val));
                    } else {
                        $("#serp_favcrumbs_mobile").text($("#url").val().replace(/\s+/g, " ").replace(/([^\/])(\/)([^\/])/g, "$1 â€º $3").replace(/\/$/, ""));
                        $("#mofo_serp_url").html(truncateUrlMobile(url_val));
                    }
                    curr_length = "<strong><span class='alert'>" + Math.floor(url_pixel_length + offset) + "px</span></strong>";
                } else if ($("#show_mobile").prop('checked')) {
                    $("#mofo_serp_url_mobile").html(url_val);
                    curr_length = Math.floor(url_pixel_length) + offset + "px";
                } else {
                    $("#mofo_serp_url").text($("#url").val().replace(/^https?:\/\//, '').replace(/\s+/g, " ").replace(/([^\/])(\/)([^\/])/g, "$1 â€º $3").replace(/\/$/, ""));
                    curr_length = Math.floor(url_pixel_length) + offset + "px";
                }
                $("#mofo_url_length").html(curr_length + '/' + max_length_url + 'px');
                $("#mofo_url_length_mobile").html(curr_length + '/' + max_length_url + 'px');
            });

            var loaded_slug = '<?php echo $_GET["slug"]; ?>';

            if (loaded_slug) {
                $.getJSON("/process_serpsim", {
                    action: 'load',
                    slug: loaded_slug
                }, function(json) {
                    $.each(json, function(i, item) {

                        var snippet_class = 'snippet_list';
                        if ($.fn.textWidth(item.title, title_font) > max_length_title || $.fn.textWidth(item.meta, meta_font) > max_length_meta) {
                            snippet_class += " error";
                        }

                        $('<div class="' + snippet_class + '" data-snippet-id="' + item.list_id + '" data-serp-title="' + item.title + '" data-serp-url="' + item.url + '" data-serp-meta="' + item.meta + '" data-list-number="' + item.list_order + '"><div class="snippet_number">' + item.list_order + '.</div><div class="snippet_text"><span class="saved_title">' + truncateString(item.title, 65) + '</span><span class="saved_url">' + truncateString(item.url, 80) + '</span></div><div class="snippet_options"><i class="material-icons delete_snippet">clear</i></div>').insertAfter($("#snippet_list_header"));
                        if ($(".snippet_list").length % 2 === 0) {
                            $(".snippet_list:first").addClass('evenDiv');
                        }
                    });
                    if ($(".snippet_list").length > 0) {
                        $("#list_container").show();
                    }
                    var data = {
                        message: 'Saved snippets loaded',
                        timeout: 2000
                    };
                    if (data) {
                        //document.querySelector('#demo-toast-example').MaterialSnackbar.showSnackbar(data);
                    }
                    loadSnippet($(".snippet_list:first"));
                });
            }

            function initialAlert() {
                var data = {
                    message: 'New META description limits: 930px desktop, 720px mobile.',
                    timeout: 10000
                };
                //      document.querySelector('#demo-toast-example').MaterialSnackbar.showSnackbar(data);
            }

            if (/Mobi/.test(navigator.userAgent)) {
                setSERPMode('mobile');
            }

            setTimeout(initialAlert, 1000);

        });
    </script>
</body>

</html>